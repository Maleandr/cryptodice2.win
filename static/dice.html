<head>
 <LINK rel=stylesheet type="text/css" href="css/main.css">
</head>

<body>
  <button id='roll_button' class="btn btn-5" onclick="onRoll()">Roll It!!!</button>
  <button id='stop_button' class="btn btn-5" onclick="onStop()">Stop!</button>
    <!-- <input id="secondroll" name="roll" type="checkbox">
    <input id="roll" name="roll" type="checkbox">
    <label for="roll" onclick="onRoll()">Roll it!</label>
    <label for="secondroll" onclick="onStop()"><span>Stop!</span></label> -->
<div id="wrapper">
  <div id="platform">
    <div id="dice">
      <div class="side front">
        <div class="dot center"></div>
      </div>
      <div class="side front inner"></div>
      <div class="side top">
        <div class="dot dtop dleft"></div>
        <div class="dot dbottom dright"></div>
      </div>
      <div class="side top inner"></div>
      <div class="side right">
        <div class="dot dtop dleft"></div>
        <div class="dot center"></div>
        <div class="dot dbottom dright"></div>
      </div>
      <div class="side right inner"></div>
      <div class="side left">
        <div class="dot dtop dleft"></div>
        <div class="dot dtop dright"></div>
        <div class="dot dbottom dleft"></div>
        <div class="dot dbottom dright"></div>
      </div>
      <div class="side left inner"></div>
      <div class="side bottom">
        <div class="dot center"></div>
        <div class="dot dtop dleft"></div>
        <div class="dot dtop dright"></div>
        <div class="dot dbottom dleft"></div>
        <div class="dot dbottom dright"></div>
      </div>
      <div class="side bottom inner"></div>
      <div class="side back">
        <div class="dot dtop dleft"></div>
        <div class="dot dtop dright"></div>
        <div class="dot dbottom dleft"></div>
        <div class="dot dbottom dright"></div>
        <div class="dot center dleft"></div>
        <div class="dot center dright"></div>
      </div>
      <div class="side back inner"></div>
      <div class="side cover x"></div>
      <div class="side cover y"></div>
      <div class="side cover z"></div>
    </div>
  </div>
</div>
<div id="overlay">
  <div class="modal_content">
      <h1>What is your bet?</h1>
      <div class="bet_area">
        <div>
          <div onClick="selectBet(this, 1)" class="side front">
            <div class="dot center"></div>
          </div>
          <div onClick="selectBet(this, 2)" class="side top">
            <div class="dot dtop dleft"></div>
            <div class="dot dbottom dright"></div>
          </div>
          <div onClick="selectBet(this, 3)" class="side right">
            <div class="dot dtop dleft"></div>
            <div class="dot center"></div>
            <div class="dot dbottom dright"></div>
          </div>
        </div>
        <div>
          <div onClick="selectBet(this, 4)" class="side left">
            <div class="dot dtop dleft"></div>
            <div class="dot dtop dright"></div>
            <div class="dot dbottom dleft"></div>
            <div class="dot dbottom dright"></div>
          </div>
          <div onClick="selectBet(this, 5)" class="side bottom">
            <div class="dot center"></div>
            <div class="dot dtop dleft"></div>
            <div class="dot dtop dright"></div>
            <div class="dot dbottom dleft"></div>
            <div class="dot dbottom dright"></div>
          </div>
          <div onClick="selectBet(this, 6)" class="side back">
            <div class="dot dtop dleft"></div>
            <div class="dot dtop dright"></div>
            <div class="dot dbottom dleft"></div>
            <div class="dot dbottom dright"></div>
            <div class="dot center dleft"></div>
            <div class="dot center dright"></div>
          </div>
        </div>
      </div>
      <button class="btn btn-5 modal-btn" onclick="completeBet()">Let's go!</button>
      </div>
  </div>
 </div>
<script>
    var translator = {
      1: 'one',
      2: 'two',
      3: 'three',
      4: 'four',
      5: 'five',
      6: 'six',
    }
    var startDate = null;
    var diff = null;
    var endAnim = null;
    var popupOpened = false;
    var choiced = null;

    function onRoll(){

      startDate = new Date();
      var rollButton = document.getElementById("roll_button");
      rollButton.style.top = "-5rem";
      var stopButton = document.getElementById("stop_button");
      stopButton.style.top = "2rem";
      var pl = document.getElementById("platform");
      pl.classList.add("running");
      setTimeout(function(){
        el = document.getElementById("overlay");
        if(el.style.opacity == 0 && !popupOpened){
          el.style.opacity = "1";
          stopButton.style.top = "-5rem";
        }
      }, 30000)
    }

    function selectBet(e, choice){
      if(document.getElementById("overlay").style.opacity == 1){
        choiced = translator[choice];
        var sides = document.querySelectorAll(".bet_area .side.selected");
        if(sides.length > 0){
          sides[0].classList.remove('selected');
        }
        e.classList.add('selected');
      }
    }

    function completeBet(){
      var modal = document.getElementById("overlay");
      modal.style.opacity = "0";
      if(diff === null){
        diff = Math.floor((new Date() - startDate)/1000);
        var platform = document.getElementById('platform');
        var dice = document.getElementById('dice');
        platform.setAttribute('style', 'animation-iteration-count: ' + (diff + 2).toString())
        dice.setAttribute('style', 'animation-iteration-count: ' + (Math.ceil(diff/2) + 4).toString())
      }
    }

    function onStop(){
      var el = document.getElementById("overlay");
      el.style.opacity = "1";
      var stopButton = document.getElementById("stop_button");
      stopButton.style.top = "-5rem";
    }

    function onEnd(e){
      var platform = document.getElementById("platform");
      if(e.animationName === 'roll' && choiced !== null){
        var res = Math.floor(Math.random() * 6) + 1;
        // platform.classList.add('pokusAnim');
        platform.classList.add(choiced + 'Anim');
      }

      if(e.animationName === 'endAnim'){
        // platform.classList.remove(endAnim);
        // platform.classList.add("showAnim");
      }
    }
    var platform = document.getElementById("platform");
    platform.addEventListener("webkitAnimationEnd", onEnd);
    platform.addEventListener("animationend", onEnd);  
  </script>
</body>

