<head>
 <LINK rel=stylesheet type="text/css" href="css/main.css">
</head>

<body>
<div id="background"></div>
<div id="wrapper">
  <input id="secondroll" name="roll" type="checkbox">
  <input id="roll" name="roll" type="checkbox">
  <label for="roll" onclick="onRoll()">Roll it!</label>
  <label for="secondroll" onclick="onStop()"><span>Stop!</span></label>
  <div id="platform">
    <div id="dice">
      <div class="side front">
        <div class="dot center"></div>
      </div>
      <div class="side front inner"></div>
      <div class="side top">
        <div class="dot dtop dleft"></div>
        <div class="dot dbottom dright"></div>
      </div>
      <div class="side top inner"></div>
      <div class="side right">
        <div class="dot dtop dleft"></div>
        <div class="dot center"></div>
        <div class="dot dbottom dright"></div>
      </div>
      <div class="side right inner"></div>
      <div class="side left">
        <div class="dot dtop dleft"></div>
        <div class="dot dtop dright"></div>
        <div class="dot dbottom dleft"></div>
        <div class="dot dbottom dright"></div>
      </div>
      <div class="side left inner"></div>
      <div class="side bottom">
        <div class="dot center"></div>
        <div class="dot dtop dleft"></div>
        <div class="dot dtop dright"></div>
        <div class="dot dbottom dleft"></div>
        <div class="dot dbottom dright"></div>
      </div>
      <div class="side bottom inner"></div>
      <div class="side back">
        <div class="dot dtop dleft"></div>
        <div class="dot dtop dright"></div>
        <div class="dot dbottom dleft"></div>
        <div class="dot dbottom dright"></div>
        <div class="dot center dleft"></div>
        <div class="dot center dright"></div>
      </div>
      <div class="side back inner"></div>
      <div class="side cover x"></div>
      <div class="side cover y"></div>
      <div class="side cover z"></div>
    </div>
  </div>
</div>
<script>
    var translator = {
      1: 'one',
      2: 'two',
      3: 'three',
      4: 'four',
      5: 'five',
      6: 'six',
    }
    var startDate = null;
    var diff = null;
    var endAnim = null;
    function onRoll(){
      startDate = new Date();
    }

    function onStop(){
      if(diff === null){
        diff = Math.floor((new Date() - startDate)/1000);
        var platform = document.getElementById('platform');
        var dice = document.getElementById('dice');
        platform.setAttribute('style', 'animation-iteration-count: ' + (diff + 2).toString())
        dice.setAttribute('style', 'animation-iteration-count: ' + (Math.ceil(diff/2) + 4).toString())
      }
    }

    function onEnd(e){
      var platform = document.getElementById("platform");
      if(e.animationName === 'roll'){
        var res = Math.floor(Math.random() * 6) + 1;
        platform.classList.add(translator[res] + 'Anim');
      }

      if(e.animationName === 'endAnim'){
        // platform.classList.remove(endAnim);
        // platform.classList.add("showAnim");
      }
    }
    var platform = document.getElementById("platform");
    platform.addEventListener("webkitAnimationEnd", onEnd);
    platform.addEventListener("animationend", onEnd);  
  </script>
</body>

